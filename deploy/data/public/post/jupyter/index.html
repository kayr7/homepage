<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academia 4.3.1">
  <meta name="generator" content="Hugo 0.69.2" />

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Kay Rottmann">

  
  
  
    
  
  <meta name="description" content="To have more than just toy examples to learn about Bayesian Inference I tried to model the total number of infections during the covid-19 outbreak">

  
  <link rel="alternate" hreflang="en-us" href="https://kay-rottmann.de/post/jupyter/">

  


  

  
  
  
  <meta name="theme-color" content="#3f51b5">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    

    

  

  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700|Roboto:400,400italic,700|Roboto+Mono&display=swap">
  

  
  
  
  <link rel="stylesheet" href="/css/academia.min.16f0ef6d9f7c7252b5f7664ba06d3abd.css">

  

  
  
  

  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="https://kay-rottmann.de/post/jupyter/">

  
  
  
  
    
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="og:site_name" content="Kay Rottmann">
  <meta property="og:url" content="https://kay-rottmann.de/post/jupyter/">
  <meta property="og:title" content="Modeling Covid-19 infections with Bayesian inference | Kay Rottmann">
  <meta property="og:description" content="To have more than just toy examples to learn about Bayesian Inference I tried to model the total number of infections during the covid-19 outbreak"><meta property="og:image" content="https://kay-rottmann.de/post/jupyter/featured.jpg">
  <meta property="twitter:image" content="https://kay-rottmann.de/post/jupyter/featured.jpg"><meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2020-04-29T00:00:00&#43;00:00">
  
  <meta property="article:modified_time" content="2020-04-29T00:00:00&#43;00:00">
  

  


  





  <title>Modeling Covid-19 infections with Bayesian inference | Kay Rottmann</title>

</head>


<body id="top" data-spy="scroll" data-target="#TableOfContents" data-offset="71" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">Kay Rottmann</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation"><span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav ml-auto">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#experience"><span>Experience</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

      

        

        

        

        

      </ul>

    </div>
  </div>
</nav>


  <article class="article py-5" itemscope itemtype="http://schema.org/Article">

  













<div class="container split-header">
  <div class="row justify-content-center">
    <div class="col-lg-8">
        <img class="img-fluid w-100" src="/post/jupyter/featured_hu16096f747301e73622470bcce69bb64a_32907_680x500_fill_q90_lanczos_smart1.jpg" itemprop="image" alt="">
        <span
          class="article-header-caption">Image credit: <a href="https://pixabay.com/de/illustrations/coronavirus-covid-19-virus-corona-4945950/"><strong>mattthewafflecat</strong></a></span>
    </div>
    <div class="col-lg-8">
      <h1 itemprop="name">Modeling Covid-19 infections with Bayesian inference</h1>

      
      <p class="page-subtitle">Exploring Bayesian Inference for modeling Covid-19 infections</p>
      

      



<meta content="2020-04-29 00:00:00 &#43;0000 UTC" itemprop="datePublished">
<meta content="2020-04-29 00:00:00 &#43;0000 UTC" itemprop="dateModified">

<div class="article-metadata">

  
  
  
  
  <div>
    



  <span itemprop="author name" itemtype="http://schema.org/Person"><a href="/authors/admin/">Kay Rottmann</a></span>

  </div>
  
  

  
  <span class="article-date">
    
    
      
    
    <time>Apr 29, 2020</time>
  </span>
  

  

  

  
  

  
  

  
    

  

</div>

      














    </div>
    
    </div>
  </div>
</div>

  <div class="article-container">

    <div class="article-style" itemprop="articleBody">
      <h1 id="trying-out-bayesian-inference-with-pymc3-on-covid-data">Trying out Bayesian inference with PyMC3 on covid data</h1>
<p><em>Disclaimer: this is in no way intended to be relied on!</em>
<em>I&rsquo;m neither an expert in pandemics, and I&rsquo;m just trying to understand and learn Bayesian Inference better.
This was done purely for me to learn something new</em></p>
<p>It doesn&rsquo;t respect reactions of the countries, it doesn&rsquo;t respect the testing capabilities / numbers in the countries, it doesn&rsquo;t respect real biological models and past research in the field of virology and pandemics.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> pymc3 <span style="color:#f92672">as</span> pm
<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
<span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#f92672">as</span> plt
<span style="color:#f92672">from</span> matplotlib.ticker <span style="color:#f92672">import</span> StrMethodFormatter
<span style="color:#f92672">import</span> seaborn <span style="color:#f92672">as</span> sns
<span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd
<span style="color:#f92672">import</span> theano
<span style="color:#f92672">%</span>matplotlib inline
<span style="color:#f92672">import</span> warnings
<span style="color:#f92672">from</span> scipy.stats <span style="color:#f92672">import</span> halfnorm
warnings<span style="color:#f92672">.</span>filterwarnings(<span style="color:#e6db74">&#39;ignore&#39;</span>)
</code></pre></div><pre><code>WARNING (theano.tensor.blas): Using NumPy C-API based implementation for BLAS functions.
</code></pre>
<h3 id="data-based-on-a-dump-from-a-wiki-page-offering-country-specific-infections">Data based on a dump from a wiki page offering country specific infections.</h3>
<p>Data is a snapshot form Kaggle taken from around mid April 2020 and wasn&rsquo;t updated since!</p>
<p>To make the data more representative, days before 2000 infections were reached were removed, since there might have been just single hotspots that were under control, also only those timeseries were looked at, that had in it&rsquo;s current state more than 20.000 infections counted.
Furthermore the data was restricted to series of at least 10 days.
These restrictions allow to look at a smaller set.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">infections <span style="color:#f92672">=</span> []
countries <span style="color:#f92672">=</span> {}

MIN_DATES <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>

<span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;untitled1.txt&#39;</span>, <span style="color:#e6db74">&#39;r&#39;</span>) <span style="color:#66d9ef">as</span> csv:
    intermediate <span style="color:#f92672">=</span> []
    counter <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    
    <span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> csv:
        
        line <span style="color:#f92672">=</span> line<span style="color:#f92672">.</span>strip()<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;,&#39;</span>)
        country <span style="color:#f92672">=</span> line[<span style="color:#ae81ff">2</span>]<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;-&#39;</span><span style="color:#f92672">+</span>line[<span style="color:#ae81ff">1</span>]
        infection <span style="color:#f92672">=</span> int(float(line[<span style="color:#ae81ff">4</span>]))
        deaths <span style="color:#f92672">=</span> int(float(line[<span style="color:#ae81ff">5</span>]))
<span style="color:#75715e">#        print(line)</span>
                
        <span style="color:#66d9ef">if</span> infection <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2000</span>:
            <span style="color:#66d9ef">continue</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> country <span style="color:#f92672">in</span> countries:
            countries[country] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
            counter <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
            <span style="color:#66d9ef">if</span> len(intermediate) <span style="color:#f92672">&gt;</span> MIN_DATES <span style="color:#f92672">and</span> intermediate[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">2</span>] <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">20000</span>:
                <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> intermediate:
                    infections<span style="color:#f92672">.</span>append(i)
                
            intermediate <span style="color:#f92672">=</span> []
        counter <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
        intermediate<span style="color:#f92672">.</span>append([country, counter, infection, deaths])
    <span style="color:#66d9ef">if</span> len(intermediate) <span style="color:#f92672">&gt;</span> MIN_DATES:
        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> intermediate:
            infections<span style="color:#f92672">.</span>append(i)


        
full_df <span style="color:#f92672">=</span> None
full_df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame(infections, columns<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;country&#39;</span>, <span style="color:#e6db74">&#39;day&#39;</span>, <span style="color:#e6db74">&#39;infections&#39;</span>, <span style="color:#e6db74">&#39;deaths&#39;</span>])
full_df <span style="color:#f92672">=</span> full_df<span style="color:#f92672">.</span>astype({<span style="color:#e6db74">&#39;day&#39;</span>: <span style="color:#e6db74">&#39;int32&#39;</span>, <span style="color:#e6db74">&#39;infections&#39;</span>: <span style="color:#e6db74">&#39;int32&#39;</span>, <span style="color:#e6db74">&#39;deaths&#39;</span>: <span style="color:#e6db74">&#39;int32&#39;</span>})

<span style="color:#75715e">#filters = full_df.country.apply(lambda x: x in [</span>
<span style="color:#75715e">#        &#39;China&#39;, &#39;Germany&#39;, &#39;Japan&#39;, &#39;South Korea&#39;, &#39;France&#39;, &#39;Netherlands&#39;])</span>
<span style="color:#75715e">#full_df=full_df[filters]</span>
countries <span style="color:#f92672">=</span> full_df<span style="color:#f92672">.</span>country<span style="color:#f92672">.</span>values
uniq_countries <span style="color:#f92672">=</span> full_df<span style="color:#f92672">.</span>country<span style="color:#f92672">.</span>unique()
n_countries <span style="color:#f92672">=</span> len(uniq_countries)

full_df[<span style="color:#e6db74">&#39;country_idx&#39;</span>] <span style="color:#f92672">=</span> [list(uniq_countries)<span style="color:#f92672">.</span>index(x) <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> countries]
<span style="color:#75715e">#print(full_df.country_idx)</span>
<span style="color:#75715e">#print(full_df)</span>
<span style="color:#66d9ef">print</span>(list(enumerate(uniq_countries)))
</code></pre></div><pre><code>[(0, 'Belgium-'), (1, 'Brazil-'), (2, 'Canada-Quebec'), (3, 'China-Hubei'), (4, 'Ecuador-'), (5, 'France-'), (6, 'Germany-'), (7, 'India-'), (8, 'Iran-'), (9, 'Italy-'), (10, 'Netherlands-'), (11, 'Peru-'), (12, 'Portugal-'), (13, 'Russia-'), (14, 'Spain-'), (15, 'Switzerland-'), (16, 'Turkey-'), (17, 'US-California'), (18, 'US-Connecticut'), (19, 'US-Florida'), (20, 'US-Georgia'), (21, 'US-Illinois'), (22, 'US-Louisiana'), (23, 'US-Massachusetts'), (24, 'US-Michigan'), (25, 'US-New Jersey'), (26, 'US-New York'), (27, 'US-Pennsylvania'), (28, 'US-Texas'), (29, 'United Kingdom-')]
</code></pre>
<h3 id="here-is-the-modeling-part">here is the modeling part</h3>
<p>the base idea is to fit a sigmoid like function to model the number of total infections. This assumption alone is probably already enough reason to not trust any output of this model. So <em>please don&rsquo;t trust</em> the model.</p>
<p>Instead of using the regular sigmoid, I chose the <em>Gompertz Function</em>:</p>
<p>\begin{equation}
\large{
f(x) = a \cdot e^{b \cdot e^{c \cdot x} }
}
\end{equation}</p>
<p>The reason for using the Gompertz function is it&rsquo;s assymmetrie, allowing to adjust for the exponential increase ans slow down phases.
with $b, c &lt; 0$ the value of $a$ determines the upper limit and therefore in our investigation the upper limit of infections.
$b$ and $c$ determine the speeed and acceleration.</p>
<p>To have some benefit from all the past countries, I tried to model $b$ and $c$ hierarchical, having a &ldquo;mean value&rdquo; across all time series, and the individual time series deviates from this according to a small normal distribution. The idea is, to have estimates for how things will develop even when very little hints are in the data.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> theano <span style="color:#f92672">import</span> shared
predictors <span style="color:#f92672">=</span> full_df<span style="color:#f92672">.</span>day<span style="color:#f92672">.</span>values<span style="color:#f92672">.</span>copy()
predictors_shared <span style="color:#f92672">=</span> shared(predictors)
country_id <span style="color:#f92672">=</span> full_df<span style="color:#f92672">.</span>country_idx<span style="color:#f92672">.</span>values<span style="color:#f92672">.</span>copy()
country_idx <span style="color:#f92672">=</span> shared(country_id)


<span style="color:#f92672">from</span> theano <span style="color:#f92672">import</span> shared
predictors <span style="color:#f92672">=</span> full_df<span style="color:#f92672">.</span>day<span style="color:#f92672">.</span>values<span style="color:#f92672">.</span>copy()
predictors_shared <span style="color:#f92672">=</span> shared(predictors)



<span style="color:#f92672">import</span> scipy
<span style="color:#66d9ef">with</span> pm<span style="color:#f92672">.</span>Model() <span style="color:#66d9ef">as</span> model:
    
    a <span style="color:#f92672">=</span> pm<span style="color:#f92672">.</span>Uniform(<span style="color:#e6db74">&#39;a&#39;</span>, lower<span style="color:#f92672">=</span><span style="color:#ae81ff">1000</span>, upper<span style="color:#f92672">=</span><span style="color:#ae81ff">1000000</span>, shape<span style="color:#f92672">=</span>n_countries)
    b_base <span style="color:#f92672">=</span> pm<span style="color:#f92672">.</span>Uniform(<span style="color:#e6db74">&#39;b_base&#39;</span>, lower<span style="color:#f92672">=-</span><span style="color:#ae81ff">8</span>, upper<span style="color:#f92672">=-</span><span style="color:#ae81ff">3</span>)
    b <span style="color:#f92672">=</span> pm<span style="color:#f92672">.</span>Normal(<span style="color:#e6db74">&#39;b&#39;</span>, mu<span style="color:#f92672">=</span>b_base, sigma<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, shape<span style="color:#f92672">=</span>n_countries)
    c_base <span style="color:#f92672">=</span> pm<span style="color:#f92672">.</span>Uniform(<span style="color:#e6db74">&#39;c_base&#39;</span>, lower<span style="color:#f92672">=-</span><span style="color:#ae81ff">1</span>, upper<span style="color:#f92672">=-</span><span style="color:#ae81ff">0.00001</span>)
    c <span style="color:#f92672">=</span> pm<span style="color:#f92672">.</span>Normal(<span style="color:#e6db74">&#39;c&#39;</span>, mu<span style="color:#f92672">=</span>c_base, sigma<span style="color:#f92672">=</span><span style="color:#ae81ff">0.03</span>, shape<span style="color:#f92672">=</span>n_countries)
    
    y <span style="color:#f92672">=</span> (a[country_idx] <span style="color:#f92672">*</span> pm<span style="color:#f92672">.</span>math<span style="color:#f92672">.</span>exp(b[country_idx] <span style="color:#f92672">*</span> pm<span style="color:#f92672">.</span>math<span style="color:#f92672">.</span>exp(c[country_idx] <span style="color:#f92672">*</span> (predictors_shared))))
    obs <span style="color:#f92672">=</span> pm<span style="color:#f92672">.</span>Normal(<span style="color:#e6db74">&#39;obs&#39;</span>, mu<span style="color:#f92672">=</span>y, sigma<span style="color:#f92672">=</span><span style="color:#ae81ff">5000</span>, observed<span style="color:#f92672">=</span>full_df<span style="color:#f92672">.</span>infections<span style="color:#f92672">.</span>values)

    trace <span style="color:#f92672">=</span> pm<span style="color:#f92672">.</span>sample(<span style="color:#ae81ff">20000</span>, cores<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
    
</code></pre></div><h3 id="now-plotting-the-results-of-the-fittings">Now plotting the results of the fittings</h3>
<p>The fittings did not work out very well, we will see why when we look at the traces.</p>
<p>We can see some pretty wide confidence intervals, so like the output suggested it didn&rsquo;t work out too well.
Interestingly this is especially then the case, when the counts haven&rsquo;t turned into the slow down phase where the infections are under control. This also makes sense, because the model has to guess which kind of behavior it will see when the infections get under control, without having any hints on it.
But here is the hierarchical model at least helping a bit, interpolating from overal behavior of the infections to the individual case.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> pymc3 <span style="color:#f92672">import</span> forestplot

plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">20</span>,<span style="color:#ae81ff">20</span>))
forestplot(trace, var_names<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;a&#39;</span>])
forestplot(trace, var_names<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;b&#39;</span>])
forestplot(trace, var_names<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;c&#39;</span>])

pm<span style="color:#f92672">.</span>traceplot(trace)
<span style="color:#66d9ef">print</span>(list(enumerate(uniq_countries)))
</code></pre></div><pre><code>[(0, 'Belgium-'), (1, 'Brazil-'), (2, 'Canada-Quebec'), (3, 'China-Hubei'), (4, 'Ecuador-'), (5, 'France-'), (6, 'Germany-'), (7, 'India-'), (8, 'Iran-'), (9, 'Italy-'), (10, 'Netherlands-'), (11, 'Peru-'), (12, 'Portugal-'), (13, 'Russia-'), (14, 'Spain-'), (15, 'Switzerland-'), (16, 'Turkey-'), (17, 'US-California'), (18, 'US-Connecticut'), (19, 'US-Florida'), (20, 'US-Georgia'), (21, 'US-Illinois'), (22, 'US-Louisiana'), (23, 'US-Massachusetts'), (24, 'US-Michigan'), (25, 'US-New Jersey'), (26, 'US-New York'), (27, 'US-Pennsylvania'), (28, 'US-Texas'), (29, 'United Kingdom-')]



&lt;Figure size 1440x1440 with 0 Axes&gt;
</code></pre>
<p><img src="output_7_2.png" alt="png"></p>
<p><img src="output_7_3.png" alt="png"></p>
<p><img src="output_7_4.png" alt="png"></p>
<p><img src="output_7_5.png" alt="png"></p>
<h3 id="now-predicting-the-future">now predicting the future&hellip;</h3>
<p>the traceplot above show what we already assumed, had some issues, especially the base values of c and b didn&rsquo;t fully converge to a single distribution, normally you would do a reparametrization and probably increase tuning steps to fix this.
But still let us try to now use the found model parameters to simulate how it&rsquo;s going to continue.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#ppc = pm.sample_posterior_predictive(trace, samples=500, model=model)</span>
x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>tile(np<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">100</span>)<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#39;int32&#39;</span>), n_countries)
<span style="color:#66d9ef">print</span>(len(x))
predictors_shared<span style="color:#f92672">.</span>set_value(x)

y <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>repeat(np<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>,n_countries<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,n_countries)<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#39;int32&#39;</span>), <span style="color:#ae81ff">100</span>)
<span style="color:#66d9ef">print</span>(len(y))
country_idx<span style="color:#f92672">.</span>set_value(y)

<span style="color:#66d9ef">with</span> model:
    post_pred <span style="color:#f92672">=</span> pm<span style="color:#f92672">.</span>sample_posterior_predictive(trace, samples<span style="color:#f92672">=</span><span style="color:#ae81ff">10000</span>)
</code></pre></div><pre><code>  0%|          | 35/10000 [00:00&lt;00:28, 345.46it/s]

3000
3000


100%|██████████| 10000/10000 [00:18&lt;00:00, 532.00it/s]
</code></pre>
<h3 id="looking-at-fittings-and-predictions">looking at fittings and predictions</h3>
<p>What we can actually see is that the model fitted the given points quite ok, but the predictions have quite a lot uncertainty. Especially in those cases, where there is little hint as to how much the region was able to slow down.
So again don&rsquo;t rely on this model for anything.
This was done purely as an educational exercise.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
means <span style="color:#f92672">=</span> post_pred[<span style="color:#e6db74">&#39;obs&#39;</span>]<span style="color:#f92672">.</span>mean(axis<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, keepdims<span style="color:#f92672">=</span>False)<span style="color:#f92672">.</span>copy()
stds <span style="color:#f92672">=</span> post_pred[<span style="color:#e6db74">&#39;obs&#39;</span>]<span style="color:#f92672">.</span>std(axis<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(n_countries):
    choice <span style="color:#f92672">=</span> y<span style="color:#f92672">==</span>i
    old_choice <span style="color:#f92672">=</span> full_df<span style="color:#f92672">.</span>country_idx<span style="color:#f92672">==</span>i

    plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">10</span>))
    plt<span style="color:#f92672">.</span>errorbar(np<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">100</span>,<span style="color:#ae81ff">100</span>),
                 means[choice],
                 stds[choice],
                 linestyle<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;None&#39;</span>,
                 marker<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;.&#39;</span>)
    plt<span style="color:#f92672">.</span>plot(np<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">1</span>,len(full_df[old_choice]), len(full_df[old_choice])),
             full_df<span style="color:#f92672">.</span>infections[old_choice],
             marker<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;o&#39;</span>)
    plt<span style="color:#f92672">.</span>title(uniq_countries[i])
    plt<span style="color:#f92672">.</span>show()




</code></pre></div><p><img src="output_11_0.png" alt="png"></p>
<p><img src="output_11_1.png" alt="png"></p>
<p><img src="output_11_2.png" alt="png"></p>
<p><img src="output_11_3.png" alt="png"></p>
<p><img src="output_11_4.png" alt="png"></p>
<p><img src="output_11_5.png" alt="png"></p>
<p><img src="output_11_6.png" alt="png"></p>
<p><img src="output_11_7.png" alt="png"></p>
<p><img src="output_11_8.png" alt="png"></p>
<p><img src="output_11_9.png" alt="png"></p>
<p><img src="output_11_10.png" alt="png"></p>
<p><img src="output_11_11.png" alt="png"></p>
<p><img src="output_11_12.png" alt="png"></p>
<p><img src="output_11_13.png" alt="png"></p>
<p><img src="output_11_14.png" alt="png"></p>
<p><img src="output_11_15.png" alt="png"></p>
<p><img src="output_11_16.png" alt="png"></p>
<p><img src="output_11_17.png" alt="png"></p>
<p><img src="output_11_18.png" alt="png"></p>
<p><img src="output_11_19.png" alt="png"></p>
<p><img src="output_11_20.png" alt="png"></p>
<p><img src="output_11_21.png" alt="png"></p>
<p><img src="output_11_22.png" alt="png"></p>
<p><img src="output_11_23.png" alt="png"></p>
<p><img src="output_11_24.png" alt="png"></p>
<p><img src="output_11_25.png" alt="png"></p>
<p><img src="output_11_26.png" alt="png"></p>
<p><img src="output_11_27.png" alt="png"></p>
<p><img src="output_11_28.png" alt="png"></p>
<p><img src="output_11_29.png" alt="png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
</code></pre></div>
    </div>

    



    
      








  
  
    
  
  





  
  
  
    
  
  
  <div class="media author-card" itemscope itemtype="http://schema.org/Person">
    

    <div class="media-body">
      <h5 class="card-title" itemprop="name"><a href="https://kay-rottmann.de/">Kay Rottmann</a></h5>
      
      <p class="card-text" itemprop="description">My professional interests include applied machine learning and artificial intelligence solutions.</p>
      <ul class="network-icon" aria-hidden="true">
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="/#contact" >
              <i class="fas fa-envelope"></i>
            </a>
          </li>
        
          
          
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://scholar.google.com/citations?user=YLUnbqEAAAAJ" target="_blank" rel="noopener">
              <i class="ai ai-google-scholar"></i>
            </a>
          </li>
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://github.com/kayr7" target="_blank" rel="noopener">
              <i class="fab fa-github"></i>
            </a>
          </li>
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://www.linkedin.com/in/kay-rottmann-5279798a/" target="_blank" rel="noopener">
              <i class="fab fa-linkedin"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>



      
      
    

    

    


  </div>
</article>

      

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js" integrity="sha256-aYTdUrn6Ow1DDgh5JTc3aDGnnju48y/1c8s1dgkYPQ8=" crossorigin="anonymous"></script>
        
      

      
      
    

    
    

    
    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    

    
    

    

    
    

    
    

    
    
    
    
    
    
    
    
    
    
    
    
    <script src="/js/academia.min.7276a6a3624de715a5c7f54c7c07696d.js"></script>

    






  
  <div class="container">
    <footer class="site-footer">

  <div class="container">
    <div class="row">
      <div class="col-md-6">
        
        <p>
          
          Powered by
          <a href="https://themefisher.com" target="_blank" rel="noopener">themefisher</a> for
          <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.
        </p>
      </div>
      <div class="col-md-6">
        <ul class="list-inline network-icon text-right">
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li class="list-inline-item">
            <a href="https://www.linkedin.com/in/kay-rottmann-5279798a/" target="_blank" rel="noopener" title="Connect on LinkedIn"><i class="fab fa-linkedin" aria-hidden="true"></i></a>
          </li>
          
          
          
          
          
          
          
          
          
          
          <li class="list-inline-item">
            <a href="https://scholar.google.com/citations?user=YLUnbqEAAAAJ" target="_blank" rel="noopener" title="Google Scholar"><i class="ai ai-google-scholar" aria-hidden="true"></i></a>
          </li>
          
          
          
          
          
          
          
          
          
          
          
          
          <li class="list-inline-item">
            <a href="https://github.com/kayr7" target="_blank" rel="noopener" title="Github"><i class="fab fa-github" aria-hidden="true"></i></a>
          </li>
          
        </ul>
      </div>
    </div>
  </div>
</footer>
  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
